<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">

    <!-- Предзагрузка данных -->
    <link rel="preload" href="./data/books.json" as="fetch" crossorigin="anonymous">
    
    <!-- Предзагрузка изображений -->
    <link rel="preload" href="./data/1.jpg" as="image">
    <link rel="preload" href="./data/2.jpg" as="image">
    <link rel="preload" href="./data/3.jpg" as="image">
    <link rel="preload" href="./data/4.jpg" as="image">
    <link rel="preload" href="./data/5.jpg" as="image">
    <link rel="preload" href="./data/6.jpg" as="image">
    <link rel="preload" href="./data/7.jpg" as="image">
    <link rel="preload" href="./data/8.jpg" as="image">
    <link rel="preload" href="./data/9.jpg" as="image">
    <link rel="preload" href="./data/10.jpg" as="image">
    <link rel="preload" href="./data/11.jpg" as="image">
    <link rel="preload" href="./data/12.jpg" as="image">
    <link rel="preload" href="./data/13.jpg" as="image">
    <link rel="preload" href="./data/14.jpg" as="image">
    <link rel="preload" href="./data/15.jpg" as="image">
    <link rel="preload" href="./data/16.jpg" as="image">
    <link rel="preload" href="./data/17.jpg" as="image">
    <link rel="preload" href="./data/18.jpg" as="image">
    <link rel="preload" href="./data/19.jpg" as="image">
    <link rel="preload" href="./data/20.jpg" as="image">
    <link rel="preload" href="./data/21.jpg" as="image">
    <link rel="preload" href="./data/22.jpg" as="image">
    <link rel="preload" href="./data/23.jpg" as="image">
    <link rel="preload" href="./data/24.jpg" as="image">
    <link rel="preload" href="./data/25.jpg" as="image">
    <link rel="preload" href="./data/26.jpg" as="image">
    <link rel="preload" href="./data/27.jpg" as="image">
    <link rel="preload" href="./data/28.jpg" as="image">
    <link rel="preload" href="./data/29.jpg" as="image">
    <link rel="preload" href="./data/30.jpg" as="image">
    <link rel="preload" href="./data/31.jpg" as="image">
    <link rel="preload" href="./data/32.jpg" as="image">
    <link rel="preload" href="./data/33.jpg" as="image">
    <link rel="preload" href="./data/34.jpg" as="image">
    <link rel="preload" href="./data/35.jpg" as="image">
    <link rel="preload" href="./data/36.jpg" as="image">
    <link rel="preload" href="./data/37.jpg" as="image">
    <link rel="preload" href="./data/38.jpg" as="image">
    <link rel="preload" href="./data/39.jpg" as="image">
    <link rel="preload" href="./data/40.jpg" as="image">
    <link rel="preload" href="./data/41.jpg" as="image">
    <link rel="preload" href="./data/42.jpg" as="image">
    <link rel="preload" href="./data/43.jpg" as="image">
    <link rel="preload" href="./data/44.jpg" as="image">
    <link rel="preload" href="./data/45.jpg" as="image">
    <link rel="preload" href="./data/46.jpg" as="image">
    <link rel="preload" href="./data/47.jpg" as="image">
    <link rel="preload" href="./data/48.jpg" as="image">
    <link rel="preload" href="./data/49.jpg" as="image">
    <link rel="preload" href="./data/50.jpg" as="image">
    
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="noindex,nofollow" />

    
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    <script>
        function setThemeClass() {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        }

        Telegram.WebApp.onEvent('themeChanged', setThemeClass);
        setThemeClass();
    </script>
    <title></title>

  <style>
    body {
      font-family: sans-serif;
      background-color: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #222);
      font-size: 14px;
      margin: 0;
      padding: 10px;
    }

    .book-card {
      display: flex;
      align-items: center;
      background-color: var(--tg-theme-secondary-bg-color, #f9f9f9);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 14px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .book-card img {
      width: 90px;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      margin-right: 14px;
      flex-shrink: 0;
      background-color: #eee;
    }

    .book-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
      flex-grow: 1;
    }

    .book-title {
      font-size: 16px;
      margin-bottom: 10px;
      line-height: 1.4;
      font-weight: 500;
    }

    .counter {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 17px; /* было 14px */
  padding-right: 7px; /* было 6px */
  margin-top: 7px; /* было 6px */
}

.counter button {
  width: 53px; /* было 44px */
  height: 53px; /* было 44px */
  font-size: 31px; /* было 26px */
  border: none;
  border-radius: 14px; /* было 12px */
  background-color: var(--tg-theme-button-color, #50a8eb);
  color: var(--tg-theme-button-text-color, #fff);
  cursor: pointer;
}

.counter span {
  font-size: 24px; /* было 20px */
  min-width: 34px; /* было 28px */
  text-align: center;
  font-weight: bold;
}

    @media (max-width: 380px) {
      .book-card {
        padding: 8px;
        margin-bottom: 10px;
      }

      .book-card img {
        width: 70px;
        height: 95px;
        margin-right: 10px;
      }

      .book-title {
        font-size: 15px;
        margin-bottom: 6px;
      }

    .counter {
        gap: 12px; /* было 10px */
        padding-right: 5px; /* было 4px */
    }

    .counter button {
        width: 46px; /* было 38px */
        height: 46px; /* было 38px */
        font-size: 26px; /* было 22px */
        border-radius: 12px; /* было 10px */
    }

    .counter span {
        font-size: 22px; /* было 18px */
    }
    }
  </style>
</head>

<body style="visibility:hidden;">

  <section id="top_sect"></section>

  <script>
    const DemoApp = {
      initData: Telegram.WebApp.initData || '',
      initDataUnsafe: Telegram.WebApp.initDataUnsafe || {},
      MainButton: Telegram.WebApp.MainButton,
      maxBooks: 4,
      selectedCount: 0,

      init() {
        document.body.style.visibility = '';
        Telegram.WebApp.MainButton.showProgress();
        Telegram.WebApp.ready();
        Telegram.WebApp.disableVerticalSwipes();
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.setParams({
          text: 'Отправить',
          is_visible: true
        }).onClick(DemoApp.sendData);
      },

      sendData() {
        const quantities = document.querySelectorAll('.quantity');
        let message = '';
        let hasSelection = false;

        quantities.forEach(span => {
          const count = parseInt(span.getAttribute('data-count'));
          if (count > 0) {
            const bookName = span.closest('.book-info').querySelector('.book-title').textContent;
            message += `${bookName} /${count}шт.\n`;
            hasSelection = true;
          }
        });

        if (!hasSelection) {
          Telegram.WebApp.showAlert('Ничего не выбрано');
          return;
        }

        Telegram.WebApp.sendData(message.trim());
        Telegram.WebApp.close();
      },

      loadData() {
        fetch('./data/books.json')
          .then(response => response.json())
          .then(data => {
            const books = data.books
            DemoApp.renderBooks(books);
          })
          .catch(error => {
            console.error('Ошибка при загрузке данных:', error);
            Telegram.WebApp.MainButton.hideProgress();
          });
      },

      renderBooks(books) {
        const section = document.getElementById('top_sect');
        section.innerHTML = '';

        books.forEach(book => {
            const card = document.createElement('div');
            card.className = 'book-card';
            card.innerHTML = `
            <img src="${book.image}" alt="${book.name}">
            <div class="book-info">
                <div class="book-title">${book.name.replace(/\n/g, '<br>')}</div>
                <div class="counter">
                <button class="decrease" data-id="${book.id}">−</button>
                <span id="quantity-${book.id}" class="quantity" data-count="0">0</span>
                <button class="increase" data-id="${book.id}">+</button>
                </div>
            </div>
            `;
            section.appendChild(card);
        });

        document.querySelectorAll('.increase').forEach(btn => {
          btn.addEventListener('click', e => {
            const id = e.target.getAttribute('data-id');
            const span = document.getElementById(`quantity-${id}`);
            let count = parseInt(span.getAttribute('data-count'));

            if (DemoApp.selectedCount >= DemoApp.maxBooks) {
              Telegram.WebApp.showAlert(`Вы не можете выбрать более ${DemoApp.maxBooks} книг.`);
              return;
            }

            Telegram.WebApp.HapticFeedback.impactOccurred('light');
            span.setAttribute('data-count', count + 1);
            span.textContent = count + 1;
            DemoApp.selectedCount++;
          });
        });

        document.querySelectorAll('.decrease').forEach(btn => {
          btn.addEventListener('click', e => {
            const id = e.target.getAttribute('data-id');
            const span = document.getElementById(`quantity-${id}`);
            let count = parseInt(span.getAttribute('data-count'));

            Telegram.WebApp.HapticFeedback.impactOccurred('light');
            if (count > 0) {
              span.setAttribute('data-count', count - 1);
              span.textContent = count - 1;
              DemoApp.selectedCount--;
            }
          });
        });

        Telegram.WebApp.MainButton.hideProgress();
      }
    };

    DemoApp.init();
    Telegram.WebApp.setHeaderColor('secondary_bg_color');
    DemoApp.loadData();
  </script>
</body>

</html>
